#define ENABLE_NE10_FIR_DECIMATE_FLOAT_NEON
#include <libraries/ne10/NE10.h>
#include <vector>

class Decimator
{
public:
	Decimator(){};
	Decimator(unsigned int factor, unsigned int blocksize){ setup(factor, blocksize); };
	int setup(unsigned int factor, unsigned int blocksize);
	
	std::vector<float> output;
	std::vector<float>& decimate(std::vector<float>& input);
	
	~Decimator(){ cleanup(); };
	void cleanup();
	
private:
	ne10_fir_decimate_instance_f32_t	firFilter;	
	ne10_float32_t *  					source = nullptr;		
	ne10_float32_t *  					destiny = nullptr;
	unsigned int						outSize;
	ne10_uint32_t  						blockSize;				
	ne10_uint8_t						factor;						
	ne10_uint16_t						numTaps;		
	ne10_float32_t*						firFilterState;	
	ne10_float32_t*						firFilterCoeff;
	ne10_float32_t factor4Coeff[229] = { // 3db ripple to 5000HZ, -96dB from 5512Hz, 229 taps
	  -0.00006436434428590806,
	  -0.00024616068120708454,
	  -0.0006394735447626211,
	  -0.0013152837148469048,
	  -0.0022773427157360125,
	  -0.003407837691852003,
	  -0.004439137991283538,
	  -0.004977907876280499,
	  -0.004595494554575912,
	  -0.0029727696802096513,
	  -0.00005785229038410228,
	  0.0038253460211148515,
	  0.007978166742448351,
	  0.011468618798568309,
	  0.013392470866349128,
	  0.01317811439208405,
	  0.010824613200245355,
	  0.006968351732877772,
	  0.002725727534835641,
	  -0.0006570947456784656,
	  -0.0022330098958503078,
	  -0.0017006298365020002,
	  0.00047573414766181687,
	  0.00323729313074327,
	  0.005341846048067395,
	  0.005858674532458786,
	  0.0045454985349765815,
	  0.0019443556277482824,
	  -0.0008536826463925124,
	  -0.0026828442606999263,
	  -0.0028145852218056737,
	  -0.0012811477183829406,
	  0.0011386156685381688,
	  0.00327219235220826,
	  0.004090991161181228,
	  0.003188230445413893,
	  0.0009731202947204594,
	  -0.00151625774504596,
	  -0.0031015516417600302,
	  -0.0030284680356517046,
	  -0.001337879318176428,
	  0.001140446654549489,
	  0.003178582139996357,
	  0.0037456020868035567,
	  0.002521097500291629,
	  0.00007144156625743585,
	  -0.0024090936082756228,
	  -0.0036779849691627297,
	  -0.0030666843816406107,
	  -0.0008355004640186565,
	  0.0019267773128571375,
	  0.0038251059751450863,
	  0.0038549839129902973,
	  0.0019281760454361535,
	  -0.001046314126882777,
	  -0.003585948960768755,
	  -0.004369064400739185,
	  -0.002919026071471502,
	  0.0001136976553031036,
	  0.003234480816486149,
	  0.004834127535687195,
	  0.004012234215672264,
	  0.00107583786679981,
	  -0.0025592010165652545,
	  -0.005043643597126422,
	  -0.0050288112448441235,
	  -0.00239094419985081,
	  0.0016391591519611377,
	  0.0050403416003435,
	  0.006005645347518906,
	  0.0038923368940491925,
	  -0.00037744710014734625,
	  -0.0047045548541155505,
	  -0.006834370245432008,
	  -0.005520374790318236,
	  -0.0012349836010709743,
	  0.003968944865089933,
	  0.007427046390847271,
	  0.007212724424880828,
	  0.0031909060872112966,
	  -0.0027905211148216043,
	  -0.007728738472535045,
	  -0.008953102196153362,
	  -0.005544764048062767,
	  0.0010537884774383674,
	  0.007614602181597316,
	  0.010674863008591466,
	  0.008330643946074448,
	  0.001361410485068614,
	  -0.006952240596932448,
	  -0.012330172674381397,
	  -0.011646110542112535,
	  -0.0046731597028932086,
	  0.005518974387023562,
	  0.013844894683751302,
	  0.015660571031323345,
	  0.009245033700335671,
	  -0.0029681605824943055,
	  -0.015174077219639493,
	  -0.020814451159520637,
	  -0.015905396495329325,
	  -0.0014714388866118818,
	  0.016250306353950042,
	  0.028222513488918455,
	  0.02679029904264917,
	  0.009838226606744846,
	  -0.017064329157732427,
	  -0.04179261554520062,
	  -0.049961004409606054,
	  -0.030831847363294314,
	  0.01757064050622858,
	  0.08640342672896766,
	  0.15812020668031043,
	  0.21218314285709772,
	  0.23227009184042693,
	  0.21218314285709772,
	  0.15812020668031043,
	  0.08640342672896766,
	  0.01757064050622858,
	  -0.030831847363294314,
	  -0.049961004409606054,
	  -0.04179261554520062,
	  -0.017064329157732427,
	  0.009838226606744846,
	  0.02679029904264917,
	  0.028222513488918455,
	  0.016250306353950042,
	  -0.0014714388866118818,
	  -0.015905396495329325,
	  -0.020814451159520637,
	  -0.015174077219639493,
	  -0.0029681605824943055,
	  0.009245033700335671,
	  0.015660571031323345,
	  0.013844894683751302,
	  0.005518974387023562,
	  -0.0046731597028932086,
	  -0.011646110542112535,
	  -0.012330172674381397,
	  -0.006952240596932448,
	  0.001361410485068614,
	  0.008330643946074448,
	  0.010674863008591466,
	  0.007614602181597316,
	  0.0010537884774383674,
	  -0.005544764048062767,
	  -0.008953102196153362,
	  -0.007728738472535045,
	  -0.0027905211148216043,
	  0.0031909060872112966,
	  0.007212724424880828,
	  0.007427046390847271,
	  0.003968944865089933,
	  -0.0012349836010709743,
	  -0.005520374790318236,
	  -0.006834370245432008,
	  -0.0047045548541155505,
	  -0.00037744710014734625,
	  0.0038923368940491925,
	  0.006005645347518906,
	  0.0050403416003435,
	  0.0016391591519611377,
	  -0.00239094419985081,
	  -0.0050288112448441235,
	  -0.005043643597126422,
	  -0.0025592010165652545,
	  0.00107583786679981,
	  0.004012234215672264,
	  0.004834127535687195,
	  0.003234480816486149,
	  0.0001136976553031036,
	  -0.002919026071471502,
	  -0.004369064400739185,
	  -0.003585948960768755,
	  -0.001046314126882777,
	  0.0019281760454361535,
	  0.0038549839129902973,
	  0.0038251059751450863,
	  0.0019267773128571375,
	  -0.0008355004640186565,
	  -0.0030666843816406107,
	  -0.0036779849691627297,
	  -0.0024090936082756228,
	  0.00007144156625743585,
	  0.002521097500291629,
	  0.0037456020868035567,
	  0.003178582139996357,
	  0.001140446654549489,
	  -0.001337879318176428,
	  -0.0030284680356517046,
	  -0.0031015516417600302,
	  -0.00151625774504596,
	  0.0009731202947204594,
	  0.003188230445413893,
	  0.004090991161181228,
	  0.00327219235220826,
	  0.0011386156685381688,
	  -0.0012811477183829406,
	  -0.0028145852218056737,
	  -0.0026828442606999263,
	  -0.0008536826463925124,
	  0.0019443556277482824,
	  0.0045454985349765815,
	  0.005858674532458786,
	  0.005341846048067395,
	  0.00323729313074327,
	  0.00047573414766181687,
	  -0.0017006298365020002,
	  -0.0022330098958503078,
	  -0.0006570947456784656,
	  0.002725727534835641,
	  0.006968351732877772,
	  0.010824613200245355,
	  0.01317811439208405,
	  0.013392470866349128,
	  0.011468618798568309,
	  0.007978166742448351,
	  0.0038253460211148515,
	  -0.00005785229038410228,
	  -0.0029727696802096513,
	  -0.004595494554575912,
	  -0.004977907876280499,
	  -0.004439137991283538,
	  -0.003407837691852003,
	  -0.0022773427157360125,
	  -0.0013152837148469048,
	  -0.0006394735447626211,
	  -0.00024616068120708454,
	  -0.00006436434428590806
	};
	
	ne10_float32_t factor2Coeff[117]{ // 3dB ripple to 10000Hz. -96db from 11000, 117 taps
		0.00016216547717600328,
		0.0002495484255972183,
	  -0.0014202219909404711,
	  -0.00750782363813223,
	  -0.01783824594532769,
	  -0.025784554356521147,
	  -0.02208662106518247,
	  -0.005900601893044972,
	  0.010048579351251325,
	  0.011214812050186653,
	  -0.0010245723645476291,
	  -0.009724166369713256,
	  -0.00395489430590952,
	  0.0066531521925275805,
	  0.006264958046484275,
	  -0.0036604029082553096,
	  -0.007114903532802655,
	  0.0010951554581792504,
	  0.007195153108662842,
	  0.0010831862903500666,
	  -0.006832238713073327,
	  -0.002980223614466638,
	  0.0061572581676372085,
	  0.004673100530494495,
	  -0.005222181786842589,
	  -0.006235695400591106,
	  0.0039805348285139085,
	  0.007655829632659337,
	  -0.002379440837721912,
	  -0.008855248271959318,
	  0.00041343525036864327,
	  0.009758529187021033,
	  0.0019183410257943058,
	  -0.0102769420551735,
	  -0.0046148559546617465,
	  0.010286934031595122,
	  0.007641992996607062,
	  -0.009648848816181412,
	  -0.010927384248280379,
	  0.008226849106580857,
	  0.0143807983691686,
	  -0.005882757656104116,
	  -0.01792214829619118,
	  0.0024172937532255002,
	  0.021445477131192985,
	  0.0024543331426958113,
	  -0.02478654365958818,
	  -0.009091849542287408,
	  0.02785614360361604,
	  0.018248506726299095,
	  -0.03057044101215127,
	  -0.03160358942633006,
	  0.03278043820420968,
	  0.0534465258441793,
	  -0.034410729664468676,
	  -0.09981147299757971,
	  0.03547880246526167,
	  0.31622880302149126,
	  0.46423502197512256,
	  0.31622880302149126,
	  0.03547880246526167,
	  -0.09981147299757971,
	  -0.034410729664468676,
	  0.0534465258441793,
	  0.03278043820420968,
	  -0.03160358942633006,
	  -0.03057044101215127,
	  0.018248506726299095,
	  0.02785614360361604,
	  -0.009091849542287408,
	  -0.02478654365958818,
	  0.0024543331426958113,
	  0.021445477131192985,
	  0.0024172937532255002,
	  -0.01792214829619118,
	  -0.005882757656104116,
	  0.0143807983691686,
	  0.008226849106580857,
	  -0.010927384248280379,
	  -0.009648848816181412,
	  0.007641992996607062,
	  0.010286934031595122,
	  -0.0046148559546617465,
	  -0.0102769420551735,
	  0.0019183410257943058,
	  0.009758529187021033,
	  0.00041343525036864327,
	  -0.008855248271959318,
	  -0.002379440837721912,
	  0.007655829632659337,
	  0.0039805348285139085,
	  -0.006235695400591106,
	  -0.005222181786842589,
	  0.004673100530494495,
	  0.0061572581676372085,
	  -0.002980223614466638,
	  -0.006832238713073327,
	  0.0010831862903500666,
	  0.007195153108662842,
	  0.0010951554581792504,
	  -0.007114903532802655,
	  -0.0036604029082553096,
	  0.006264958046484275,
	  0.0066531521925275805,
	  -0.00395489430590952,
	  -0.009724166369713256,
	  -0.0010245723645476291,
	  0.011214812050186653,
	  0.010048579351251325,
	  -0.005900601893044972,
	  -0.02208662106518247,
	  -0.025784554356521147,
	  -0.01783824594532769,
	  -0.00750782363813223,
	  -0.0014202219909404711,
	  0.0002495484255972183,
	  0.00016216547717600328
	};
};